# OpenTDF Platform Examples

Examples demonstrating the usage of the OpenTDF Platform Services.

These examples can be launched using an example CLI.
[See the autogenerated cobra docs](./docs/examples.md).

## Building the Examples CLI

```shell
go build -o examples-cli
```

## Quick Start

```shell
# List attributes
./examples-cli attributes ls

# Run encryption example
./examples-cli encrypt sensitive.txt -o sensitive.txt.tdf
```

## Available Examples

### Core Services
- [Attribute Service](./cmd/attributes.go) - Manage and query data attributes
- [Authorization Service](./cmd/authorization.go) - Authorization and access control

### Assertion
- [Assertion](./cmd/assertion.go) - Examples of custom signing and validation providers.

### Encryption & Decryption
- [Encrypt](./cmd/encrypt.go) - Create encrypted TDF files
- [Decrypt](./cmd/decrypt.go) - Decrypt TDF files with optional assertion validation
- [IsValid](./cmd/isvalid.go) - Validate TDF files

### Key Access Service (KAS)
- [KAS Operations](./cmd/kas.go) - Key access service operations

### Benchmarking
- [Benchmark](./cmd/benchmark.go) - Performance benchmarking
- [Benchmark Bulk](./cmd/benchmark_bulk.go) - Bulk operation benchmarks
- [Decision Benchmarks](./cmd/benchmark_decision.go) - Decision service benchmarks

## Assertion Provider Examples

The `assertion` command demonstrates custom signing and validation for TDF assertions using assertion binders and validators.

### Adding an Assertion to an Existing TDF

Add a new assertion to an existing TDF without re-encrypting payload data:

```shell
./examples-cli assertion add --in sensitive.tdf --out sensitive-plus-assertion.tdf --magic-word swordfish
```

### Magic Word Provider

Demonstration provider using HMAC-SHA256 for cryptographic binding:
- **Binding Method**: `hmac-sha256`
- **Statement**: HMAC hash of the magic word
- **Signature**: HMAC over manifest root signature and assertion hash
- **Use Case**: Educational example, not for production

### Implementation Details

Implement `AssertionBinder` for signing and `AssertionValidator` for verification. Validators must implement `Schema()` for pattern-based routing.

See:
- [Assertion Provider Interfaces](../sdk/assertion_provider.go)
- [Assertion Registry](../sdk/assertion_provider_registry.go)
- [Assertions](../docs/Assertions.md)
- [Troubleshooting](../docs/Assertions-Troubleshooting.md)

**Security Note:** Examples use simple keys for demonstration. Production use requires HSMs, KMS, or password-protected keys.

## Configuration Options

The examples CLI supports various configuration options:

```shell
# Platform connection options
./examples-cli --platformEndpoint https://your-platform.example.com \
              --creds client-id:client-secret \
              --tokenEndpoint https://auth.example.com/token

# Security options
./examples-cli --insecureSkipVerify    # Skip TLS verification (dev only)
./examples-cli --insecurePlaintextConn # Use plaintext connection (dev only)

# Example with full configuration
./examples-cli assertion add --in sensitive.tdf --out sensitive-plus-assertion.tdf --magic-word swordfish \
              --platformEndpoint https://platform.example.com 
              --creds myapp:mysecret
```

## Environment Setup

For local development and testing:

```shell
./examples-cli --platformEndpoint "http://localhost:8080" --creds "opentdf:secret" \
attributes ls
```

```shell
./examples-cli --platformEndpoint "http://localhost:8080" --creds "opentdf:secret" \
encrypt --autoconfigure=false README.md -o sensitive.txt.tdf
```

```shell
./examples-cli --platformEndpoint "http://localhost:8080" --creds "opentdf:secret" \
assertion add --in sensitive.txt.tdf --out sensitive-plus-assertion.tdf --magic-word swordfish
```

```shell
./examples-cli --platformEndpoint "http://localhost:8080" --creds "opentdf:secret" \
decrypt sensitive-plus-assertion.tdf --magic-word swordfish
```
