# OpenTDF Platform Examples

Examples demonstrating the usage of the OpenTDF Platform Services.

These examples can be launched using an example CLI.
[See the autogenerated cobra docs](./docs/examples.md).

## Building the Examples CLI

```shell
go build -o examples-cli
```

## Quick Start

```shell
# List attributes
./examples-cli attributes ls

# Run encryption example
./examples-cli encrypt sensitive.txt -o sensitive.txt.tdf
```

## Available Examples

### Core Services
- [Attribute Service](./cmd/attributes.go) - Manage and query data attributes
- [Authorization Service](./cmd/authorization.go) - Authorization and access control

### Assertion
- [Assertion](./cmd/assertion.go) - Examples of custom signing and validation providers.

### Encryption & Decryption
- [Encrypt](./cmd/encrypt.go) - Create encrypted TDF files.
- [Decrypt](./cmd/decrypt.go) - Decrypt TDF files. Now includes a "Magic Word" example for simple custom validation.
- [IsValid](./cmd/isvalid.go) - Validate TDF files

### Key Access Service (KAS)
- [KAS Operations](./cmd/kas.go) - Key access service operations

### Benchmarking
- [Benchmark](./cmd/benchmark.go) - Performance benchmarking
- [Benchmark Bulk](./cmd/benchmark_bulk.go) - Bulk operation benchmarks
- [Decision Benchmarks](./cmd/benchmark_decision.go) - Decision service benchmarks

## Assertion Provider Examples

The `assertion` command demonstrates how to implement custom signing and validation for TDF assertions using assertion binders and validators.

### Adding an Assertion to an Existing TDF

The `assertion add` subcommand demonstrates how to add a new assertion to an existing TDF. The TDF manifest is read, the new assertion is added, and the manifest is rewritten. This updates only the manifest structure without re-encrypting the payload data, making it an efficient operation for adding assertions post-creation.

**To use this example:**

```shell
# Add a new assertion to a TDF, creating a new output file
./examples-cli assertion add --in sensitive.tdf --out sensitive-plus-assertion.tdf --magic-word swordfish
```

### Implementation Details

The provider interfaces allow developers to:
- Implement custom signing logic without modifying the core SDK.
- Support hardware tokens that never expose private keys.
- Validate assertions using custom trust models.
- Maintain backward compatibility while adding new capabilities.

For full implementation details, see:
- [Assertion Provider Interfaces](../sdk/assertion_provider.go)
- [Assertion Registry](../sdk/assertion_provider_registry.go)
- [Assertions](../docs/Assertions.md) - Signature format for interoperability
- [Troubleshooting Assertions](../docs/Assertions-Troubleshooting.md) - Common issues and solutions

**Security Note:** The examples use unencrypted private keys for simplicity. In production:
- Use password-protected private keys or hardware security modules (HSMs)
- Store keys in secure key management systems (AWS KMS, Azure Key Vault, etc.)
- Set restrictive file permissions on key files (`chmod 600`)
- Never commit private keys to version control

## Configuration Options

The examples CLI supports various configuration options:

```shell
# Platform connection options
./examples-cli --platformEndpoint https://your-platform.example.com \
              --creds client-id:client-secret \
              --tokenEndpoint https://auth.example.com/token

# Security options
./examples-cli --insecureSkipVerify    # Skip TLS verification (dev only)
./examples-cli --insecurePlaintextConn # Use plaintext connection (dev only)

# Example with full configuration
./examples-cli assertion add --in sensitive.tdf --out sensitive-plus-assertion.tdf --magic-word swordfish \
              --platformEndpoint https://platform.example.com 
              --creds myapp:mysecret
```

## Environment Setup

For local development and testing:

```shell
./examples-cli --platformEndpoint "http://localhost:8080" --creds "opentdf:secret" \
attributes ls
```

```shell
./examples-cli --platformEndpoint "http://localhost:8080" --creds "opentdf:secret" \
encrypt --autoconfigure=false README.md -o sensitive.txt.tdf
```

```shell
./examples-cli --platformEndpoint "http://localhost:8080" --creds "opentdf:secret" \
assertion add --in sensitive.txt.tdf --out sensitive-plus-assertion.tdf --magic-word swordfish
```

```shell
./examples-cli --platformEndpoint "http://localhost:8080" --creds "opentdf:secret" \
decrypt sensitive-plus-assertion.tdf --magic-word swordfish
```
