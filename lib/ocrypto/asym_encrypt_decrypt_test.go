package ocrypto

import (
	"crypto/sha256"
	"testing"
)

func salty(s string) []byte {
	digest := sha256.New()
	digest.Write([]byte(s))
	return digest.Sum(nil)
}

func TestAsymEncryptionAndDecryption(t *testing.T) {
	var keypairs = []struct {
		privateKey string
		publicKey  string
		salt       []byte
		info       []byte
	}{
		{ // Test 2048 key
			`-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCu8piKYWnESnnx
kZOCJo9FgTOuKRNncY/QqFYhitAUBtZ0TSq9JL7wvFxQNCiKwWTW7HUI72K5SXJl
0p4axvOxOYmN2Ticegfl/8GIvNMQl6YMiNc9Xm9hxj77hAqEVtl/9cstnaFLMC5f
Plk4J6UD8pmz5lvX1WWtrkMIMnjeap2ioUgNLhyXya25EMLlTDfHVLna2c79Mo8M
aPfZpVIYEqHQJYYBdZGamHMaPuQWmQDFPVvzbsytAxjGSfjDZYHwH9sYrPT51bKq
efMZgBKFUnSsiI0Tx0NbNAJEF+K8t6ZeFfxQUgLKhLmLQjB6cW9OvpPzkS8zErdp
ICUbJrffAgMBAAECggEAQqf36rGW5M0jjSDUPQCIEglaMX9A/2bLTsr0li8XfKnm
R8WnBQ3dGkgKPBzDXaq1yxWoudDLoqETTyxiRP2Ml/e+KyeaZDQykjVR/dFD8cx1
3cy9hYpXkb9A+/+hKi8VC6YQ1b57V/RxlqRgxf6E5u4mFd8tGx0ZcoU00Qi5+LOw
tfSKLPNg4OujraCmrq/bgNkNEiMwHK2AQTbr31uhygUiGTmdXVZu1FLqg7WPGZyZ
x/0U83x0dx6A890OFaebw7I84/tmyJYqutgkK3BhsvIHj1sr34PNdbAMACY/+vqu
r5H7+oCvILlo4pVQ760NBWxIvv6GQGIedH/18GuX4QKBgQDlXxMuyUnUPVXCZWgw
ckvaTXYpQY8om9L4tPeQpQWFhT7pVByQhxIKcmwpAvz5ZhTZUo3ERfuYgheoM6Ay
0AXeuSGagpYWT+rb2DusmDgZIn6wBaMdZX1tll4rNTPOb0rRpQasyJRd6Li9+C9G
A8cRxDKZfiaLSXi2xT45fZuFCQKBgQDDQgugZVGdbIMWJd5KfB7VQbjbkmt+6Q5r
pMY4NMXYCggG1DUuaNwC5Ptl2QE3Z98ZJnYhAvXW0IaD7OyjqOItA00Q4+v8nv/I
Bu5hCtIFHx+xCQtWL8IApjTckmen8YmFNBSgQHsCBR7oR51orgHu9HsPcTh5Jq5V
oBr67a43pwKBgQCIYTJvtCFgv6NZNaBwhdUSFNK4DxIGzDfxxvAYIfaZgDN62pct
XBJfAc/LxsoRpB+rZAmE9TN2Z4uXaDLNY6DJ3/vZ+eExnQ0A8J3yroNUdo0rLf7h
gLHGUgzl1flauhObeWrxm0WUXMZTtdit4Zsgti5702UplmLfEYJA/q1UuQKBgBbb
jHDia4N6SH43QKaHkTR11SYfJeZdcgq351x9EQwRYI8sGG2uaNMN60Ao/zN1PXC8
R+flaNIU5ypaeflOs+uBD2yCwgV4t4i7BvzlP2DKG/Olk2YrgRKCYn3PxcKrS+YE
CsYXxk6eOtgGSi8O77sBc8aDApFsLcxoScBGQrbRAoGANZKkKXpe7kNn05Td5JMY
QchqRD9x1z/8zyWSnwpRlfUG3RnRRqyv14gHK1sTaIcb6hTKkcUnoP6cBQZOR8wQ
b9jhi/YwGgMbC7wI11l70vJzf1ydKfI0JeGy51UP/8bCw8sAf67z/S7nwWZBUsrM
X3wz+2TeAgQK0jsLzrv0R8A=
-----END PRIVATE KEY-----`,
			`-----BEGIN PUBLIC KEY-----
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEArvKYimFpxEp58ZGTgiaP
RYEzrikTZ3GP0KhWIYrQFAbWdE0qvSS+8LxcUDQoisFk1ux1CO9iuUlyZdKeGsbz
sTmJjdk4nHoH5f/BiLzTEJemDIjXPV5vYcY++4QKhFbZf/XLLZ2hSzAuXz5ZOCel
A/KZs+Zb19Vlra5DCDJ43mqdoqFIDS4cl8mtuRDC5Uw3x1S52tnO/TKPDGj32aVS
GBKh0CWGAXWRmphzGj7kFpkAxT1b827MrQMYxkn4w2WB8B/bGKz0+dWyqnnzGYAS
hVJ0rIiNE8dDWzQCRBfivLemXhX8UFICyoS5i0IwenFvTr6T85EvMxK3aSAlGya3
3wIDAQAB
-----END PUBLIC KEY-----`,
			salty("L1L"),
			nil,
		},
		{ // Test 3072 key
			`-----BEGIN PRIVATE KEY-----
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
RGJNCu8EOLaRCIFBcbA7AZgALQ==
-----END PRIVATE KEY-----`,
			`-----BEGIN PUBLIC KEY-----
MIIBojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEA3z8f7MYtqU1iDBGuibqC
7AbtK8zwI2eIdqbZo+znsX4WXlN5Su9Iyrf7deaNgy/rj5O6H0HdNYXTg89NOe3A
fJjb+z6TXdeF0dfwfIhOdTRtURVesr1b56BpbWcekLlCULe+6lFwC/zLpvXMZrCc
7ui8i1pRzdczKLat9GNvFsb+v5xR+rNjzcKTSHQFtstOenOoS3TC0xAgXEEzqkFN
VbGgsC7Y9Gmzcj5Q5okWEsX7XP/Cn4xK9nQpBF0+wLOl/7fRXIEdGHV1c5awfD7l
rgWVR+GY+R9cMcnX/Nk1hgeyI0+W6UtAHmVYNxoc0tvYCbV3/+FmHVFntlr8Uws+
KdheIKdUG+Ouv+vMTeAYOw9+5OGainDWFJA3LZHid3qbX85Y0as9n1nSKoYXMMQT
88Nx+U7Vv8fTudHUgueYGy7WtE6URRIkI5W94u5jDpcb9DZ90Wv5XhaJdRmQ2BhZ
pCVg892PjJwMcTWhIKJgX+9QEL2bSb2VY3yEpEa2b2LhAgMBAAE=
-----END PUBLIC KEY-----`,
			salty("L1L"),
			nil,
		},
		{ // Test 4096 key
			`-----BEGIN PRIVATE KEY-----
MIIJQwIBADANBgkqhkiG9w0BAQEFAASCCS0wggkpAgEAAoICAQC+lM8PnXeuw8TE
6yRCGojby6unhRVL3iEFnUl8W5SZXiya5dbod1zoanXGRe+hgwfWy4pXSOPbX0Cb
3EifHFPdsZc+mV62XGeGBBxTgttUfmN6652Yr4P65O+V3eoPeEZMMnvaOVFaWMZi
FTFKZBwQc/OlpRo9CdQfhjtuztRKjTlSvsxsH47cOtvuOAeUCl5lQnRer1Zziwio
phESnvC7fQrOl+fDItiH2HMp1yyJxFsFHiO+eIuv2/Qjmz9iHG8fR9gXTZIDzvqp
iQZk4v5xLPRQY1mkOSxJ6jw2SmNp44dAl++pdEG17X2x4fjD6ywXyphRCFtZJPhV
OxBs2HUj+sWuDfYv35SAPz5KLVfnIx5ufwJQtTuuNFVMyDlgUVFMgZdlf9pi19Kd
IrlBG3PMI/ePTFlIBgnAmgag2CAddRNARGo8fAiakI50PRR+KHpK28ak3JR7nDtg
h922g5pN36wJ5VfV1zOq4nOI69jALILiczulj7Xf4NeCzMzJ2P+N1KyEzinYZFC7
8lgMl/7sb8FVFyAJo+kHA6noRgu2Jo4BBNSDucTfZ4zgDfUin4oho7qD2wyoeX+p
zggadKER806PKsQvn6CNiCJDNVVtiRGGvZk142/N1CwzyP4jbQ5sI1jVEUKan3//
zE1uLWS5+CIHveroWeHlAd/Uc0B4xQIDAQABAoICABEo+v/v8M/WpsgIWCpvkzUf
QKSD0igTpyuHPw+oe1fX5/JGkbQ60y3GMDabI3mKf9EyYJF9aa7eA8ZE7nENLuv+
Sp0DWEjZRyUFB7vpQ3B3NOPjhTwzSZH0vTHkWmfsL4A653X9xTp6VdqNB/Qn0XMV
zbFzjUpDsUrpXj6a9viDgM7XiTaPHODtl9H6T4xf5qH9etbvuLwMn8n3sf/YOdrX
5no1qVOjtpV8wtnYmxUIjh2G2jcTSZibGH+AQhPGdab+ZBGtFWGsaFuNj/rTiY+N
Oa5nU7H6x+cb5TIKPqtRJmOFirnaUvRbnv6+VxTk/wJhZpedRgRf1NBv0gnK77kW
1ix1EW2goumrIoCMHy5umjvHRTjhC//snaTil/Tgr61xz5OLqWcvKCeYDyT3mXZF
dbwsM/S/SsGHXiYmD52+lHvwX9oxwdoBTVv42H+3nSgH77KC/dQ8GwjSddUjrwn/
gGGxWw7YeUF43LszEjjagWsVr5xgbE9DF1vllaWBKfTe/0jg2qz9D1jJHbHd4aJv
ER+gaOmp+vBOXLvH943uI84h3m1URWyEXGKDbb7lXRCsZVhFx/xUOjn94uquhOKx
UNZEWldghvRkTrWMZAHIQjjCEXW0lm0ZmAFYfWgeEXh7K90UbKH1TbUmN0FM2XIy
vyriyrJkspZcfSfOacd9AoIBAQDV6fyWPAKwb0pkVrQMO1dsF8B86BQQToHyhO5B
id8Z1q31u1mS3uSVMpn1eF/rXaT0zz1TK0tl+5Zdyyd2lFmwYvSzKVP3WE8cTUpc
5tjKXo71Zazqf1j2ojSQ6ycM7ORHYQxRkbK2dn7BvOVTa9PI3lAuS5+aLEawSb7B
Wt0TLAQXgvjdRmlnEl8X0gqNUuPR3/Bp2sFbMFLsNhlypaNS4b7OrEIiRazTZYzR
9vRs8KXH31qQTLqmRTOoRiIIfMoha4j/b6OtimMzTkD5972ECPW3Wa61b6SIXG86
dHbwjEghImWfg8GSz0IpLjyq4i39onL7ArytKkyO8/pBKsnzAoIBAQDkE6TVOLFp
QSKtkALRmm7tWv+s8VIbXao2jaARFSEj2JSA+DrP1OO1I9zRQCQYQD1bJaV8wMuX
ngdv6jJEnrs2pP5EFc4HT7E5BYtNyQ+bPV7tYAm+9pWR5BiubU6KftVgfJF6wMrd
Z6r5GK5GrLLrVNomR4XkgHVWndx4s7BZZLzYcW/Stqtut7XPnRaUefTkAXdZ/wr9
QNNFQzacEk5ymCkmjwVNoJFg92+zizPrXgE9bCjwgMJj12jpMyFxfx1Av9voD5+l
odxGYJ4ZzqXmZ78207t/NPip3DigdyqfO3JfeFKKAj9kQC/d2BxKjrw2Iiazp4XO
bRrwqiiQJ+hnAoIBACF2dPjbcmA/SJfhqFCxh791B7uCYoEahuF1QgAmnSvhlVz3
bc+35nIgdE0eA4NCJufU83brMuRFMwSBHy9BjbY2BKlyMZxjyBxZSuS1h/xARoTE
3wPf3/7U6PwyjO1MsXkpCVBJRnecmb+c2RLvrzWg8VIMqm7ntjclkh2VJTg2jn1P
E7cpqJtjGFUVmmj5KoJOUcF9Yvns2UvyOpDgsGfqwHp8H+xUkfCP1jOSOjJAgu59
ViF0n04bTTVpozFItCX+OHQc9rHTECmaeDeiNZdN/4IrGVVwnYBnVU8DoQeIKlBk
nRkS91kL6wGeJgdlUmR24R27E+DS2R8Ts3Y2R1kCggEBAOCJllV0IvUEcyd8B8pi
x6JVXDDew369j711YIhwzNeFeW4e84d4h1TloZdAFkjptX3uaiWPiOATbC752dNE
kfsSJGDTNqpsAoWot6Q0tXCX0sTPL8kY6ddfQA04/4HJrDf5ax/2fcHLNb9WVPyv
ONYGC150O5TiAqLrdwo9nPfk/SX5R6WiwNOXeR6UAI7cIgP2jZHETQVWtKgTq8er
HiAjPSAA3a+2zGkyMH4KJWsqeP4HZaagnL++akJrXBlok1wThmPIPdvKphmDNSMj
FqDmspE/ke+CLuzLKdSQfR2WYNsskdXcsJv5tSYqhG/CZfjFVmS4IDtBnqwgWR7S
qzECggEBAJlyYtpuAwmh3Euqj4qr4IPSAcG0v7Hn+K4amIrpiVNyzBT9vGIpehgB
hdfzBSE6fAy6jzQCt9ntKEySBUUPVcSLIHe44jnRtds36+APkh8oOwyFFR9dwPJJ
kgApJFe38a9+ghv6gGKQiPkb9TTmbxvmOxH3AOpmu9E2tgcpC+u+ypxSpiDQFD8/
niSdGj2JrOmu/OgAwUroiRQ6gZikJ7fxYfdaHtJ+o7HF6p9T7ehuYSd7C9RBC9sj
trtPV5YNKhz0oksAtYOMWI//fFvtzTMPFZSeVB8DWIyJ8X6/0AcDEeQ14JMoZ8Oi
kGdh/czrBuFnI2cSVhf1a6zneO+JNCQ=
-----END PRIVATE KEY-----`,
			`-----BEGIN PUBLIC KEY-----
MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAvpTPD513rsPExOskQhqI
28urp4UVS94hBZ1JfFuUmV4smuXW6Hdc6Gp1xkXvoYMH1suKV0jj219Am9xInxxT
3bGXPpletlxnhgQcU4LbVH5jeuudmK+D+uTvld3qD3hGTDJ72jlRWljGYhUxSmQc
EHPzpaUaPQnUH4Y7bs7USo05Ur7MbB+O3Drb7jgHlApeZUJ0Xq9Wc4sIqKYREp7w
u30KzpfnwyLYh9hzKdcsicRbBR4jvniLr9v0I5s/YhxvH0fYF02SA876qYkGZOL+
cSz0UGNZpDksSeo8NkpjaeOHQJfvqXRBte19seH4w+ssF8qYUQhbWST4VTsQbNh1
I/rFrg32L9+UgD8+Si1X5yMebn8CULU7rjRVTMg5YFFRTIGXZX/aYtfSnSK5QRtz
zCP3j0xZSAYJwJoGoNggHXUTQERqPHwImpCOdD0Ufih6StvGpNyUe5w7YIfdtoOa
Td+sCeVX1dczquJziOvYwCyC4nM7pY+13+DXgszMydj/jdSshM4p2GRQu/JYDJf+
7G/BVRcgCaPpBwOp6EYLtiaOAQTUg7nE32eM4A31Ip+KIaO6g9sMqHl/qc4IGnSh
EfNOjyrEL5+gjYgiQzVVbYkRhr2ZNeNvzdQsM8j+I20ObCNY1RFCmp9//8xNbi1k
ufgiB73q6Fnh5QHf1HNAeMUCAwEAAQ==
-----END PUBLIC KEY-----`,
			salty("TDF"),
			nil,
		},
		{ // Test certificate
			`-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDOpiotrvV2i5h6
clHMzDGgh3h/kMa0LoGx2OkDPd8jogycUh7pgE5GNiN2lpSmFkjxwYMXnyrwr9Ex
yczBWJ7sRGDCDaQg5fjVUIloZ8FJVbn+sEcfQ9iX6vmI9/S++oGK79QM3V8M8cp4
1r/T1YVmuzUHE1say/TLHGhjtGkxHDF8qFy6Z2rYFTCVJQHNqGmwNVGd0qG7gim8
6Hawu/CMYj4jG9oITlj8rJtQOaJ6ZqemQVoNmb3j1LkyeUKzRIt+86aoBiz+T3Tf
OEvXF6xgBj3XoiOhPYK+abFPYcrArvb6oubT8NjjQoj3j0sXWUnIIMg+e4f+XNVU
54ZzDaLZAgMBAAECggEBALb0yK0PlMUyzHnEUwXV1y5AIoAWhsYp0qvJ1msHUVKz
+yQ/VJz4+tQQxI8OvGbbnhNkd5LnWdYkYzsIZl7b/kBCPcQw3Zo+4XLCzhUAn1E1
M+n42c8le1LtN6Z7mVWoZh7DPONy7t+ABvm7b7S1+1i78DPmgCeWYZGeAhIcPXG6
5AxWIV3jigxksE6kYY9Y7DmtsZgMRrdV7SU8VtgPtT7tua8z5/U3Av0WINyKBSoM
0yDHsAg57KnM8znx2JWLtHd0Mk5bBuu2DLbtyKNrVUAUuMPzrLGBh9S9QRd934KU
uFAi1TEfgEachnGgSHJpzVzr2ur1tifABnQ7GNXObe0CgYEA6KowK0subdDY+uGW
ciP2XDAMerbJJeL0/UIGPb/LUmskniio2493UBGgY2FsRyvbzJ+/UAOjIPyIxhj7
78ZyVG8BmIzKan1RRVh//O+5yvks/eTOYjWeQ1Lcgqs3q4YAO13CEBZgKWKTUomg
mskFJq04tndeSIyhDaW+BuWaXA8CgYEA42ABz3pql+DH7oL5C4KYBymK6wFBBOqk
dVk+ftyJQ6PzuZKpfsu4aPIjKm71lkTgK6O9o08s3SckAdu6vLukq2TZFF+a+9OI
lu5ww7GvfdMTgLAaFchD4bPlOInh1KVjBc1MwGXpl0ROde5pi8+WUrv9QJuoQfB/
4rhYdbJLSpcCgYA41mqSCPm8pgp7r2RbWeGzP6Gs0L5u3PTQcbKonxQCfF4jrPcj
O/b/vm6aGJClClfVsyi/WUQeqNKY4j2Zo7cGXV/cbnh8b0TNVgNePQn8Rcbx91Vb
tJGHDNUFruIYqtGfrxXbbDvtoEExJqHvbjAt9J8oJB0KSCCH/vdfI/QDjQKBgQCD
xLPH5Y24js/O7aAeh4RLQkv7fTKNAt5kE2AgbPYveOhZ9yC7Fpy8VPcENGGmwCuZ
nr7b0ZqSX4iCezBxB92aZktXf0B2CFT0AyLehi7JoHWA8o1rai/MsVB5v45ciawl
RKDiLy18OF2wAoawO5FGSSOvOYX9EL9MSMEbFESF6QKBgCVlZ9pPC+55rGT6AcEL
tUpDs+/wZvcmfsFd8xC5mMUN0DatAVzVAUI95+tQaWU3Uj+bqHq0lC6Wy2VceG0D
D+7EicjdGFN/2WVPXiYX1fblkxasZY+wChYBrPLjA9g0qOzzmXbRBph5QxDuQjJ6
qcddVKB624a93ZBssn7OivnR
-----END PRIVATE KEY-----`,
			`-----BEGIN CERTIFICATE-----
MIICmDCCAYACCQC3BCaSANRhYzANBgkqhkiG9w0BAQsFADAOMQwwCgYDVQQDDANr
YXMwHhcNMjEwOTE1MTQxMTQ4WhcNMjIwOTE1MTQxMTQ4WjAOMQwwCgYDVQQDDANr
YXMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDOpiotrvV2i5h6clHM
zDGgh3h/kMa0LoGx2OkDPd8jogycUh7pgE5GNiN2lpSmFkjxwYMXnyrwr9ExyczB
WJ7sRGDCDaQg5fjVUIloZ8FJVbn+sEcfQ9iX6vmI9/S++oGK79QM3V8M8cp41r/T
1YVmuzUHE1say/TLHGhjtGkxHDF8qFy6Z2rYFTCVJQHNqGmwNVGd0qG7gim86Haw
u/CMYj4jG9oITlj8rJtQOaJ6ZqemQVoNmb3j1LkyeUKzRIt+86aoBiz+T3TfOEvX
F6xgBj3XoiOhPYK+abFPYcrArvb6oubT8NjjQoj3j0sXWUnIIMg+e4f+XNVU54Zz
DaLZAgMBAAEwDQYJKoZIhvcNAQELBQADggEBABewfZOJ4/KNRE8IQ5TsW/AVn7C1
l5ty6tUUBSVi8/df7WYts0bHEdQh9yl9agEU5i4rj43y8vMVZNzSeHcurtV/+C0j
fbkHQHeiQ1xn7cq3Sbh4UVRyuu4C5PklEH4AN6gxmgXC3kT15uWw8I4nm/plzYLs
I099IoRfC5djHUYYLMU/VkOIHuPC3sb7J65pSN26eR8bTMVNagk187V/xNwUuvkf
+NUxDO615/5BwQKnAu5xiIVagYnDZqKCOtYS5qhxF33Nlnwlm7hH8iVZ1RI+n52l
wVyElqp317Ksz+GtTIc+DE6oryxK3tZd4hrj9fXT4KiJvQ4pcRjpePgH7B8=
-----END CERTIFICATE-----`,
			salty("L1L"),
			nil,
		},
		{`-----BEGIN PRIVATE KEY-----
MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgwQlQvwfqC0sEaPVi
l1CdHNqAndukGsrqMsfiIefXHQChRANCAAQSZSoVakwpWhKBZIR9dmmTkKv7GK6n
6d0yFeGzOyqB7l9LOzOwlCDdm9k0jBQBw597Dyy7KQzW73zi+pSpgfYr
-----END PRIVATE KEY-----
`, `-----BEGIN CERTIFICATE-----
MIIBcTCCARegAwIBAgIUQBzVxCvhpTzXU+i7qyiTNniBL4owCgYIKoZIzj0EAwIw
DjEMMAoGA1UEAwwDa2FzMB4XDTI1MDExMDE2MzQ1NVoXDTI2MDExMDE2MzQ1NVow
DjEMMAoGA1UEAwwDa2FzMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEEmUqFWpM
KVoSgWSEfXZpk5Cr+xiup+ndMhXhszsqge5fSzszsJQg3ZvZNIwUAcOfew8suykM
1u984vqUqYH2K6NTMFEwHQYDVR0OBBYEFCAo/c694aHwmw/0kUTKuFvAQ4OcMB8G
A1UdIwQYMBaAFCAo/c694aHwmw/0kUTKuFvAQ4OcMA8GA1UdEwEB/wQFMAMBAf8w
CgYIKoZIzj0EAwIDSAAwRQIgUzKsJS6Pcu2aZ6BFfuqob552Ebdel4uFGZMqWrwW
bW0CIQDT5QED+8mHFot9JXSx2q1c5mnRvl4yElK0fiHeatBdqw==
-----END CERTIFICATE-----`,
			salty("L1L"),
			nil,
		},
	}

	for _, test := range keypairs {
		asymEncryptor, err := FromPublicPEMWithSalt(test.publicKey, test.salt, test.info)
		if err != nil {
			t.Fatalf("NewAsymEncryption - failed: %v", err)
		}

		plainText := "virtru"
		cipherText, err := asymEncryptor.Encrypt([]byte(plainText))
		if err != nil {
			t.Fatalf("AsymEncryption encrypt failed: %v", err)
		}

		asymDecryptor, err := FromPrivatePEMWithSalt(test.privateKey, test.salt, test.info)
		if err != nil {
			t.Fatalf("NewAsymDecryption - failed: %v", err)
		}

		var decryptedText []byte
		ek := asymEncryptor.EphemeralKey()
		if ek == nil {
			decryptedText, err = asymDecryptor.Decrypt(cipherText)
			if err != nil {
				t.Fatalf("AsymDecryption decrypt failed: %v", err)
			}
		} else if ecd, ok := asymDecryptor.(ECDecryptor); ok {
			decryptedText, err = ecd.DecryptWithEphemeralKey(cipherText, ek)
			if err != nil {
				t.Fatalf("AsymDecryption decrypt failed: %v", err)
			}
		} else {
			t.Fatalf("AsymDecryption wrong type: %T", asymDecryptor)
		}

		if string(decryptedText) != plainText {
			t.Error("Asym encrypt/decrypt failed")
		}
	}
}
