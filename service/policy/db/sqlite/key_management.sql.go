// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: key_management.sql

package sqlite

import (
	"context"
	"database/sql"
)

const createProviderConfig = `-- name: createProviderConfig :one

INSERT INTO provider_config (id, provider_name, manager, config, metadata)
VALUES (?1, ?2, ?3, ?4, ?5)
RETURNING id
`

type createProviderConfigParams struct {
	ID           string         `json:"id"`
	ProviderName string         `json:"provider_name"`
	Manager      string         `json:"manager"`
	Config       string         `json:"config"`
	Metadata     sql.NullString `json:"metadata"`
}

// --------------------------------------------------------------
// Provider Config (SQLite)
// --------------------------------------------------------------
// Note: ID generated in application layer before INSERT
//
//	INSERT INTO provider_config (id, provider_name, manager, config, metadata)
//	VALUES (?1, ?2, ?3, ?4, ?5)
//	RETURNING id
func (q *Queries) createProviderConfig(ctx context.Context, arg createProviderConfigParams) (string, error) {
	row := q.db.QueryRowContext(ctx, createProviderConfig,
		arg.ID,
		arg.ProviderName,
		arg.Manager,
		arg.Config,
		arg.Metadata,
	)
	var id string
	err := row.Scan(&id)
	return id, err
}

const deleteProviderConfig = `-- name: deleteProviderConfig :execrows
DELETE FROM provider_config
WHERE id = ?1
`

// deleteProviderConfig
//
//	DELETE FROM provider_config
//	WHERE id = ?1
func (q *Queries) deleteProviderConfig(ctx context.Context, id string) (int64, error) {
	result, err := q.db.ExecContext(ctx, deleteProviderConfig, id)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected()
}

const getProviderConfigFull = `-- name: getProviderConfigFull :one
SELECT
    pc.id,
    pc.provider_name,
    pc.manager,
    pc.config,
    json_object(
        'labels', json_extract(pc.metadata, '$.labels'),
        'created_at', pc.created_at,
        'updated_at', pc.updated_at
    ) AS metadata
FROM provider_config AS pc
WHERE (?1 IS NULL OR pc.id = ?1)
  AND (?2 IS NULL OR pc.provider_name = ?2)
  AND (?3 IS NULL OR pc.manager = ?3)
`

type getProviderConfigFullParams struct {
	ID      interface{} `json:"id"`
	Name    interface{} `json:"name"`
	Manager interface{} `json:"manager"`
}

type getProviderConfigFullRow struct {
	ID           string      `json:"id"`
	ProviderName string      `json:"provider_name"`
	Manager      string      `json:"manager"`
	Config       string      `json:"config"`
	Metadata     interface{} `json:"metadata"`
}

// getProviderConfigFull
//
//	SELECT
//	    pc.id,
//	    pc.provider_name,
//	    pc.manager,
//	    pc.config,
//	    json_object(
//	        'labels', json_extract(pc.metadata, '$.labels'),
//	        'created_at', pc.created_at,
//	        'updated_at', pc.updated_at
//	    ) AS metadata
//	FROM provider_config AS pc
//	WHERE (?1 IS NULL OR pc.id = ?1)
//	  AND (?2 IS NULL OR pc.provider_name = ?2)
//	  AND (?3 IS NULL OR pc.manager = ?3)
func (q *Queries) getProviderConfigFull(ctx context.Context, arg getProviderConfigFullParams) (getProviderConfigFullRow, error) {
	row := q.db.QueryRowContext(ctx, getProviderConfigFull, arg.ID, arg.Name, arg.Manager)
	var i getProviderConfigFullRow
	err := row.Scan(
		&i.ID,
		&i.ProviderName,
		&i.Manager,
		&i.Config,
		&i.Metadata,
	)
	return i, err
}

const listProviderConfigs = `-- name: listProviderConfigs :many
WITH counted AS (
    SELECT COUNT(pc.id) AS total
    FROM provider_config pc
)
SELECT
    pc.id,
    pc.provider_name,
    pc.manager,
    pc.config,
    json_object(
        'labels', json_extract(pc.metadata, '$.labels'),
        'created_at', pc.created_at,
        'updated_at', pc.updated_at
    ) AS metadata,
    counted.total
FROM provider_config AS pc
CROSS JOIN counted
LIMIT ?2
OFFSET ?1
`

type listProviderConfigsParams struct {
	Offset int64 `json:"offset_"`
	Limit  int64 `json:"limit_"`
}

type listProviderConfigsRow struct {
	ID           string      `json:"id"`
	ProviderName string      `json:"provider_name"`
	Manager      string      `json:"manager"`
	Config       string      `json:"config"`
	Metadata     interface{} `json:"metadata"`
	Total        int64       `json:"total"`
}

// listProviderConfigs
//
//	WITH counted AS (
//	    SELECT COUNT(pc.id) AS total
//	    FROM provider_config pc
//	)
//	SELECT
//	    pc.id,
//	    pc.provider_name,
//	    pc.manager,
//	    pc.config,
//	    json_object(
//	        'labels', json_extract(pc.metadata, '$.labels'),
//	        'created_at', pc.created_at,
//	        'updated_at', pc.updated_at
//	    ) AS metadata,
//	    counted.total
//	FROM provider_config AS pc
//	CROSS JOIN counted
//	LIMIT ?2
//	OFFSET ?1
func (q *Queries) listProviderConfigs(ctx context.Context, arg listProviderConfigsParams) ([]listProviderConfigsRow, error) {
	rows, err := q.db.QueryContext(ctx, listProviderConfigs, arg.Offset, arg.Limit)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []listProviderConfigsRow
	for rows.Next() {
		var i listProviderConfigsRow
		if err := rows.Scan(
			&i.ID,
			&i.ProviderName,
			&i.Manager,
			&i.Config,
			&i.Metadata,
			&i.Total,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateProviderConfig = `-- name: updateProviderConfig :execrows
UPDATE provider_config
SET
    provider_name = COALESCE(?1, provider_name),
    manager = COALESCE(?2, manager),
    config = COALESCE(?3, config),
    metadata = COALESCE(?4, metadata)
WHERE id = ?5
`

type updateProviderConfigParams struct {
	ProviderName sql.NullString `json:"provider_name"`
	Manager      sql.NullString `json:"manager"`
	Config       sql.NullString `json:"config"`
	Metadata     sql.NullString `json:"metadata"`
	ID           string         `json:"id"`
}

// updateProviderConfig
//
//	UPDATE provider_config
//	SET
//	    provider_name = COALESCE(?1, provider_name),
//	    manager = COALESCE(?2, manager),
//	    config = COALESCE(?3, config),
//	    metadata = COALESCE(?4, metadata)
//	WHERE id = ?5
func (q *Queries) updateProviderConfig(ctx context.Context, arg updateProviderConfigParams) (int64, error) {
	result, err := q.db.ExecContext(ctx, updateProviderConfig,
		arg.ProviderName,
		arg.Manager,
		arg.Config,
		arg.Metadata,
		arg.ID,
	)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected()
}
