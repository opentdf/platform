// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: registered_resources.sql

package sqlite

import (
	"context"
	"database/sql"
)

const createRegisteredResource = `-- name: createRegisteredResource :one

INSERT INTO registered_resources (id, name, metadata)
VALUES (?1, ?2, ?3)
RETURNING id
`

type createRegisteredResourceParams struct {
	ID       string         `json:"id"`
	Name     string         `json:"name"`
	Metadata sql.NullString `json:"metadata"`
}

// --------------------------------------------------------------
// REGISTERED RESOURCES (SQLite)
// --------------------------------------------------------------
// Note: ID generated in application layer before INSERT
//
//	INSERT INTO registered_resources (id, name, metadata)
//	VALUES (?1, ?2, ?3)
//	RETURNING id
func (q *Queries) createRegisteredResource(ctx context.Context, arg createRegisteredResourceParams) (string, error) {
	row := q.db.QueryRowContext(ctx, createRegisteredResource, arg.ID, arg.Name, arg.Metadata)
	var id string
	err := row.Scan(&id)
	return id, err
}

const createRegisteredResourceActionAttributeValue = `-- name: createRegisteredResourceActionAttributeValue :one

INSERT INTO registered_resource_action_attribute_values (id, registered_resource_value_id, action_id, attribute_value_id)
VALUES (?1, ?2, ?3, ?4)
RETURNING id
`

type createRegisteredResourceActionAttributeValueParams struct {
	ID                        string `json:"id"`
	RegisteredResourceValueID string `json:"registered_resource_value_id"`
	ActionID                  string `json:"action_id"`
	AttributeValueID          string `json:"attribute_value_id"`
}

// --------------------------------------------------------------
// Registered Resource Action Attribute Values (SQLite)
// --------------------------------------------------------------
// Note: ID generated in application layer before INSERT
//
//	INSERT INTO registered_resource_action_attribute_values (id, registered_resource_value_id, action_id, attribute_value_id)
//	VALUES (?1, ?2, ?3, ?4)
//	RETURNING id
func (q *Queries) createRegisteredResourceActionAttributeValue(ctx context.Context, arg createRegisteredResourceActionAttributeValueParams) (string, error) {
	row := q.db.QueryRowContext(ctx, createRegisteredResourceActionAttributeValue,
		arg.ID,
		arg.RegisteredResourceValueID,
		arg.ActionID,
		arg.AttributeValueID,
	)
	var id string
	err := row.Scan(&id)
	return id, err
}

const createRegisteredResourceValue = `-- name: createRegisteredResourceValue :one

INSERT INTO registered_resource_values (id, registered_resource_id, value, metadata)
VALUES (?1, ?2, ?3, ?4)
RETURNING id
`

type createRegisteredResourceValueParams struct {
	ID                   string         `json:"id"`
	RegisteredResourceID string         `json:"registered_resource_id"`
	Value                string         `json:"value"`
	Metadata             sql.NullString `json:"metadata"`
}

// --------------------------------------------------------------
// REGISTERED RESOURCE VALUES (SQLite)
// --------------------------------------------------------------
// Note: ID generated in application layer before INSERT
//
//	INSERT INTO registered_resource_values (id, registered_resource_id, value, metadata)
//	VALUES (?1, ?2, ?3, ?4)
//	RETURNING id
func (q *Queries) createRegisteredResourceValue(ctx context.Context, arg createRegisteredResourceValueParams) (string, error) {
	row := q.db.QueryRowContext(ctx, createRegisteredResourceValue,
		arg.ID,
		arg.RegisteredResourceID,
		arg.Value,
		arg.Metadata,
	)
	var id string
	err := row.Scan(&id)
	return id, err
}

const deleteRegisteredResource = `-- name: deleteRegisteredResource :execrows
DELETE FROM registered_resources WHERE id = ?1
`

// deleteRegisteredResource
//
//	DELETE FROM registered_resources WHERE id = ?1
func (q *Queries) deleteRegisteredResource(ctx context.Context, id string) (int64, error) {
	result, err := q.db.ExecContext(ctx, deleteRegisteredResource, id)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected()
}

const deleteRegisteredResourceActionAttributeValues = `-- name: deleteRegisteredResourceActionAttributeValues :execrows
DELETE FROM registered_resource_action_attribute_values
WHERE registered_resource_value_id = ?1
`

// deleteRegisteredResourceActionAttributeValues
//
//	DELETE FROM registered_resource_action_attribute_values
//	WHERE registered_resource_value_id = ?1
func (q *Queries) deleteRegisteredResourceActionAttributeValues(ctx context.Context, registeredResourceValueID string) (int64, error) {
	result, err := q.db.ExecContext(ctx, deleteRegisteredResourceActionAttributeValues, registeredResourceValueID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected()
}

const deleteRegisteredResourceValue = `-- name: deleteRegisteredResourceValue :execrows
DELETE FROM registered_resource_values WHERE id = ?1
`

// deleteRegisteredResourceValue
//
//	DELETE FROM registered_resource_values WHERE id = ?1
func (q *Queries) deleteRegisteredResourceValue(ctx context.Context, id string) (int64, error) {
	result, err := q.db.ExecContext(ctx, deleteRegisteredResourceValue, id)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected()
}

const getRegisteredResource = `-- name: getRegisteredResource :one
SELECT
    r.id,
    r.name,
    json_object(
        'labels', json_extract(r.metadata, '$.labels'),
        'created_at', r.created_at,
        'updated_at', r.updated_at
    ) as metadata,
    -- Values as correlated subquery (replaces JSON_AGG with FILTER)
    (
        SELECT json_group_array(
            json_object(
                'id', v.id,
                'value', v.value
            )
        )
        FROM registered_resource_values v
        WHERE v.registered_resource_id = r.id
    ) as "values"
FROM registered_resources r
WHERE
    (NULLIF(?1, '') IS NULL OR r.id = ?1) AND
    (NULLIF(?2, '') IS NULL OR r.name = ?2)
`

type getRegisteredResourceParams struct {
	ID   interface{} `json:"id"`
	Name interface{} `json:"name"`
}

type getRegisteredResourceRow struct {
	ID       string      `json:"id"`
	Name     string      `json:"name"`
	Metadata interface{} `json:"metadata"`
	Values   interface{} `json:"values"`
}

// getRegisteredResource
//
//	SELECT
//	    r.id,
//	    r.name,
//	    json_object(
//	        'labels', json_extract(r.metadata, '$.labels'),
//	        'created_at', r.created_at,
//	        'updated_at', r.updated_at
//	    ) as metadata,
//	    -- Values as correlated subquery (replaces JSON_AGG with FILTER)
//	    (
//	        SELECT json_group_array(
//	            json_object(
//	                'id', v.id,
//	                'value', v.value
//	            )
//	        )
//	        FROM registered_resource_values v
//	        WHERE v.registered_resource_id = r.id
//	    ) as "values"
//	FROM registered_resources r
//	WHERE
//	    (NULLIF(?1, '') IS NULL OR r.id = ?1) AND
//	    (NULLIF(?2, '') IS NULL OR r.name = ?2)
func (q *Queries) getRegisteredResource(ctx context.Context, arg getRegisteredResourceParams) (getRegisteredResourceRow, error) {
	row := q.db.QueryRowContext(ctx, getRegisteredResource, arg.ID, arg.Name)
	var i getRegisteredResourceRow
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Metadata,
		&i.Values,
	)
	return i, err
}

const getRegisteredResourceValue = `-- name: getRegisteredResourceValue :one
SELECT
    v.id,
    v.registered_resource_id,
    v.value,
    json_object(
        'labels', json_extract(v.metadata, '$.labels'),
        'created_at', v.created_at,
        'updated_at', v.updated_at
    ) as metadata,
    -- Action attribute values as correlated subquery
    (
        SELECT json_group_array(
            json_object(
                'action', json_object(
                    'id', a.id,
                    'name', a.name
                ),
                'attribute_value', json_object(
                    'id', av.id,
                    'value', av.value,
                    'fqn', fqns.fqn
                )
            )
        )
        FROM registered_resource_action_attribute_values rav
        LEFT JOIN actions a on rav.action_id = a.id
        LEFT JOIN attribute_values av on rav.attribute_value_id = av.id
        LEFT JOIN attribute_fqns fqns on av.id = fqns.value_id
        WHERE rav.registered_resource_value_id = v.id
    ) as action_attribute_values
FROM registered_resource_values v
JOIN registered_resources r ON v.registered_resource_id = r.id
WHERE
    (NULLIF(?1, '') IS NULL OR v.id = ?1) AND
    (NULLIF(?2, '') IS NULL OR r.name = ?2) AND
    (NULLIF(?3, '') IS NULL OR v.value = ?3)
`

type getRegisteredResourceValueParams struct {
	ID    interface{} `json:"id"`
	Name  interface{} `json:"name"`
	Value interface{} `json:"value"`
}

type getRegisteredResourceValueRow struct {
	ID                    string      `json:"id"`
	RegisteredResourceID  string      `json:"registered_resource_id"`
	Value                 string      `json:"value"`
	Metadata              interface{} `json:"metadata"`
	ActionAttributeValues interface{} `json:"action_attribute_values"`
}

// getRegisteredResourceValue
//
//	SELECT
//	    v.id,
//	    v.registered_resource_id,
//	    v.value,
//	    json_object(
//	        'labels', json_extract(v.metadata, '$.labels'),
//	        'created_at', v.created_at,
//	        'updated_at', v.updated_at
//	    ) as metadata,
//	    -- Action attribute values as correlated subquery
//	    (
//	        SELECT json_group_array(
//	            json_object(
//	                'action', json_object(
//	                    'id', a.id,
//	                    'name', a.name
//	                ),
//	                'attribute_value', json_object(
//	                    'id', av.id,
//	                    'value', av.value,
//	                    'fqn', fqns.fqn
//	                )
//	            )
//	        )
//	        FROM registered_resource_action_attribute_values rav
//	        LEFT JOIN actions a on rav.action_id = a.id
//	        LEFT JOIN attribute_values av on rav.attribute_value_id = av.id
//	        LEFT JOIN attribute_fqns fqns on av.id = fqns.value_id
//	        WHERE rav.registered_resource_value_id = v.id
//	    ) as action_attribute_values
//	FROM registered_resource_values v
//	JOIN registered_resources r ON v.registered_resource_id = r.id
//	WHERE
//	    (NULLIF(?1, '') IS NULL OR v.id = ?1) AND
//	    (NULLIF(?2, '') IS NULL OR r.name = ?2) AND
//	    (NULLIF(?3, '') IS NULL OR v.value = ?3)
func (q *Queries) getRegisteredResourceValue(ctx context.Context, arg getRegisteredResourceValueParams) (getRegisteredResourceValueRow, error) {
	row := q.db.QueryRowContext(ctx, getRegisteredResourceValue, arg.ID, arg.Name, arg.Value)
	var i getRegisteredResourceValueRow
	err := row.Scan(
		&i.ID,
		&i.RegisteredResourceID,
		&i.Value,
		&i.Metadata,
		&i.ActionAttributeValues,
	)
	return i, err
}

const listRegisteredResourceValues = `-- name: listRegisteredResourceValues :many
WITH counted AS (
    SELECT COUNT(id) AS total
    FROM registered_resource_values
    WHERE
        NULLIF(?1, '') IS NULL OR registered_resource_id = ?1
)
SELECT
    v.id,
    v.registered_resource_id,
    v.value,
    json_object(
        'labels', json_extract(v.metadata, '$.labels'),
        'created_at', v.created_at,
        'updated_at', v.updated_at
    ) as metadata,
    -- Action attribute values as correlated subquery
    (
        SELECT json_group_array(
            json_object(
                'action', json_object(
                    'id', a.id,
                    'name', a.name
                ),
                'attribute_value', json_object(
                    'id', av.id,
                    'value', av.value,
                    'fqn', fqns.fqn
                )
            )
        )
        FROM registered_resource_action_attribute_values rav
        LEFT JOIN actions a on rav.action_id = a.id
        LEFT JOIN attribute_values av on rav.attribute_value_id = av.id
        LEFT JOIN attribute_fqns fqns on av.id = fqns.value_id
        WHERE rav.registered_resource_value_id = v.id
    ) as action_attribute_values,
    counted.total
FROM registered_resource_values v
JOIN registered_resources r ON v.registered_resource_id = r.id
CROSS JOIN counted
WHERE
    NULLIF(?1, '') IS NULL OR v.registered_resource_id = ?1
GROUP BY v.id, counted.total
LIMIT ?3
OFFSET ?2
`

type listRegisteredResourceValuesParams struct {
	RegisteredResourceID interface{} `json:"registered_resource_id"`
	Offset               int64       `json:"offset_"`
	Limit                int64       `json:"limit_"`
}

type listRegisteredResourceValuesRow struct {
	ID                    string      `json:"id"`
	RegisteredResourceID  string      `json:"registered_resource_id"`
	Value                 string      `json:"value"`
	Metadata              interface{} `json:"metadata"`
	ActionAttributeValues interface{} `json:"action_attribute_values"`
	Total                 int64       `json:"total"`
}

// listRegisteredResourceValues
//
//	WITH counted AS (
//	    SELECT COUNT(id) AS total
//	    FROM registered_resource_values
//	    WHERE
//	        NULLIF(?1, '') IS NULL OR registered_resource_id = ?1
//	)
//	SELECT
//	    v.id,
//	    v.registered_resource_id,
//	    v.value,
//	    json_object(
//	        'labels', json_extract(v.metadata, '$.labels'),
//	        'created_at', v.created_at,
//	        'updated_at', v.updated_at
//	    ) as metadata,
//	    -- Action attribute values as correlated subquery
//	    (
//	        SELECT json_group_array(
//	            json_object(
//	                'action', json_object(
//	                    'id', a.id,
//	                    'name', a.name
//	                ),
//	                'attribute_value', json_object(
//	                    'id', av.id,
//	                    'value', av.value,
//	                    'fqn', fqns.fqn
//	                )
//	            )
//	        )
//	        FROM registered_resource_action_attribute_values rav
//	        LEFT JOIN actions a on rav.action_id = a.id
//	        LEFT JOIN attribute_values av on rav.attribute_value_id = av.id
//	        LEFT JOIN attribute_fqns fqns on av.id = fqns.value_id
//	        WHERE rav.registered_resource_value_id = v.id
//	    ) as action_attribute_values,
//	    counted.total
//	FROM registered_resource_values v
//	JOIN registered_resources r ON v.registered_resource_id = r.id
//	CROSS JOIN counted
//	WHERE
//	    NULLIF(?1, '') IS NULL OR v.registered_resource_id = ?1
//	GROUP BY v.id, counted.total
//	LIMIT ?3
//	OFFSET ?2
func (q *Queries) listRegisteredResourceValues(ctx context.Context, arg listRegisteredResourceValuesParams) ([]listRegisteredResourceValuesRow, error) {
	rows, err := q.db.QueryContext(ctx, listRegisteredResourceValues, arg.RegisteredResourceID, arg.Offset, arg.Limit)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []listRegisteredResourceValuesRow
	for rows.Next() {
		var i listRegisteredResourceValuesRow
		if err := rows.Scan(
			&i.ID,
			&i.RegisteredResourceID,
			&i.Value,
			&i.Metadata,
			&i.ActionAttributeValues,
			&i.Total,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listRegisteredResources = `-- name: listRegisteredResources :many
WITH counted AS (
    SELECT COUNT(id) AS total
    FROM registered_resources
)
SELECT
    r.id,
    r.name,
    json_object(
        'labels', json_extract(r.metadata, '$.labels'),
        'created_at', r.created_at,
        'updated_at', r.updated_at
    ) as metadata,
    -- Values with action_attribute_values as correlated subquery
    -- Note: SQLite doesn't support LATERAL, so we use a scalar subquery
    (
        SELECT json_group_array(
            json_object(
                'id', v.id,
                'value', v.value,
                'action_attribute_values', (
                    SELECT json_group_array(
                        json_object(
                            'action', json_object(
                                'id', a.id,
                                'name', a.name
                            ),
                            'attribute_value', json_object(
                                'id', av.id,
                                'value', av.value,
                                'fqn', fqns.fqn
                            )
                        )
                    )
                    FROM registered_resource_action_attribute_values rav
                    LEFT JOIN actions a on rav.action_id = a.id
                    LEFT JOIN attribute_values av on rav.attribute_value_id = av.id
                    LEFT JOIN attribute_fqns fqns on av.id = fqns.value_id
                    WHERE rav.registered_resource_value_id = v.id
                )
            )
        )
        FROM registered_resource_values v
        WHERE v.registered_resource_id = r.id
    ) as "values",
    counted.total
FROM registered_resources r
CROSS JOIN counted
GROUP BY r.id, counted.total
LIMIT ?2
OFFSET ?1
`

type listRegisteredResourcesParams struct {
	Offset int64 `json:"offset_"`
	Limit  int64 `json:"limit_"`
}

type listRegisteredResourcesRow struct {
	ID       string      `json:"id"`
	Name     string      `json:"name"`
	Metadata interface{} `json:"metadata"`
	Values   interface{} `json:"values"`
	Total    int64       `json:"total"`
}

// listRegisteredResources
//
//	WITH counted AS (
//	    SELECT COUNT(id) AS total
//	    FROM registered_resources
//	)
//	SELECT
//	    r.id,
//	    r.name,
//	    json_object(
//	        'labels', json_extract(r.metadata, '$.labels'),
//	        'created_at', r.created_at,
//	        'updated_at', r.updated_at
//	    ) as metadata,
//	    -- Values with action_attribute_values as correlated subquery
//	    -- Note: SQLite doesn't support LATERAL, so we use a scalar subquery
//	    (
//	        SELECT json_group_array(
//	            json_object(
//	                'id', v.id,
//	                'value', v.value,
//	                'action_attribute_values', (
//	                    SELECT json_group_array(
//	                        json_object(
//	                            'action', json_object(
//	                                'id', a.id,
//	                                'name', a.name
//	                            ),
//	                            'attribute_value', json_object(
//	                                'id', av.id,
//	                                'value', av.value,
//	                                'fqn', fqns.fqn
//	                            )
//	                        )
//	                    )
//	                    FROM registered_resource_action_attribute_values rav
//	                    LEFT JOIN actions a on rav.action_id = a.id
//	                    LEFT JOIN attribute_values av on rav.attribute_value_id = av.id
//	                    LEFT JOIN attribute_fqns fqns on av.id = fqns.value_id
//	                    WHERE rav.registered_resource_value_id = v.id
//	                )
//	            )
//	        )
//	        FROM registered_resource_values v
//	        WHERE v.registered_resource_id = r.id
//	    ) as "values",
//	    counted.total
//	FROM registered_resources r
//	CROSS JOIN counted
//	GROUP BY r.id, counted.total
//	LIMIT ?2
//	OFFSET ?1
func (q *Queries) listRegisteredResources(ctx context.Context, arg listRegisteredResourcesParams) ([]listRegisteredResourcesRow, error) {
	rows, err := q.db.QueryContext(ctx, listRegisteredResources, arg.Offset, arg.Limit)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []listRegisteredResourcesRow
	for rows.Next() {
		var i listRegisteredResourcesRow
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Metadata,
			&i.Values,
			&i.Total,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateRegisteredResource = `-- name: updateRegisteredResource :execrows
UPDATE registered_resources
SET
    name = COALESCE(?1, name),
    metadata = COALESCE(?2, metadata)
WHERE id = ?3
`

type updateRegisteredResourceParams struct {
	Name     sql.NullString `json:"name"`
	Metadata sql.NullString `json:"metadata"`
	ID       string         `json:"id"`
}

// updateRegisteredResource
//
//	UPDATE registered_resources
//	SET
//	    name = COALESCE(?1, name),
//	    metadata = COALESCE(?2, metadata)
//	WHERE id = ?3
func (q *Queries) updateRegisteredResource(ctx context.Context, arg updateRegisteredResourceParams) (int64, error) {
	result, err := q.db.ExecContext(ctx, updateRegisteredResource, arg.Name, arg.Metadata, arg.ID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected()
}

const updateRegisteredResourceValue = `-- name: updateRegisteredResourceValue :execrows
UPDATE registered_resource_values
SET
    value = COALESCE(?1, value),
    metadata = COALESCE(?2, metadata)
WHERE id = ?3
`

type updateRegisteredResourceValueParams struct {
	Value    sql.NullString `json:"value"`
	Metadata sql.NullString `json:"metadata"`
	ID       string         `json:"id"`
}

// updateRegisteredResourceValue
//
//	UPDATE registered_resource_values
//	SET
//	    value = COALESCE(?1, value),
//	    metadata = COALESCE(?2, metadata)
//	WHERE id = ?3
func (q *Queries) updateRegisteredResourceValue(ctx context.Context, arg updateRegisteredResourceValueParams) (int64, error) {
	result, err := q.db.ExecContext(ctx, updateRegisteredResourceValue, arg.Value, arg.Metadata, arg.ID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected()
}
