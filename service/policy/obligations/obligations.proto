syntax = "proto3";

package policy.obligations;

import "common/common.proto";
import "policy/objects.proto";
import "google/protobuf/struct.proto";

///
/// Obligation
///

// Definitions
message GetObligationRequest {
    string id = 1;
}

message GetObligationResponse {
    policy.Obligation obligation = 1;
}

message CreateObligationRequest {
    // Required
    string namespace_id = 1;
    string name = 2;
    // Optional
    // Common metadata
    common.MetadataMutable metadata = 100;
}

message CreateObligationResponse {
    policy.Obligation obligation = 1;
}

message UpdateObligationRequest {
  // Required
  string id = 1;

  // Optional
  common.MetadataMutable metadata = 100;
  common.MetadataUpdateEnum metadata_update_behavior = 101;
}

message UpdateObligationResponse {
  policy.Obligation obligation = 1;
}

// Values
message GetObligationValueRequest {
    string id = 1;
}

message GetObligationValueResponse {
    policy.ObligationValue value = 1;
}

message CreateObligationValueRequest {
    // Required
    string obligation_id = 1;
    string value = 2;
    // Optional
    // Common metadata
    common.MetadataMutable metadata = 100;
}

message CreateObligationValueResponse {
    policy.ObligationValue value = 1;
}

message UpdateObligationValueRequest {
    // Required
    string id = 1;
    
    // Optional
    common.MetadataMutable metadata = 100;
    common.MetadataUpdateEnum metadata_update_behavior = 101;
}

message UpdateObligationValueResponse {
    policy.ObligationValue value = 1;
}

// Triggers
message AddObligationTriggerRequest {
    // Required
    string obligation_value_id = 1;
    string action_id = 2;
    string attribute_value_id = 3;
    // Optional
    // Common metadata
    common.MetadataMutable metadata = 100;
}

message AddObligationTriggerResponse {
    policy.ObligationTrigger trigger = 1;
}

message RemoveObligationTriggerRequest {
    string id = 1;
}

message RemoveObligationTriggerResponse {
    policy.ObligationTrigger trigger = 1;
}

// Fulfillers
message AddObligationFulfillerRequest {
    // Required
    string obligation_value_id = 1;
    google.protobuf.Struct conditionals = 2;
    // Optional
    // Common metadata
    common.MetadataMutable metadata = 100;
}

message AddObligationFulfillerResponse {
    policy.ObligationFulfiller fulfiller = 1;
}

message RemoveObligationFulfillerRequest {
    string id = 1;
}

message RemoveObligationFulfillerResponse {
    policy.ObligationFulfiller fulfiller = 1;
}